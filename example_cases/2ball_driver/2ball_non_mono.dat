model new
program load contactmodelmechanical '../contactmodelmechanical3dmacroelement007.dll'
model domain extent -1.7 1.7

ball create radius 1.35e-3 group 'dt0' position 0 0 0
ball create radius 1.35e-3 group 'dt1' position 0.06 0 0
program call 'load_properties'


contact cmat proximity 0.06
contact cmat apply
model clean
contact property lin_mode 1
contact method bond gap 4
model energy mechanical on
model large-strain on
;model mechanical timestep fix 1e-7
[disp = 0]
[force = 0]
fish hist @disp
fish hist @force

ball fix velocity range id 1
ball fix spin range id 1
ball attribute density 2700 
model gravity 9.81
ball attribute velocity-x 1.0 range id 2
ball attribute damp 0.5
[b = ball.find(2)]
[c = ball.contactmap(b,1)]
ball history displacement-x id 2 
ball history displacement-z id 2 
ball history force-contact-x id 2
ball history euler-y id 2
model orientation-tracking on

def getWp 

c = ball.contactmap(b)
loop foreach cc c
;io.out(contact.prop(cc,'me_wp'))
wp = contact.prop(cc,'me_wp')
force = contact.prop(cc,'me_force')

endloop
end
[wp = 0]
fish history @wp
fish callback add @getWp -1
cy; 10000
